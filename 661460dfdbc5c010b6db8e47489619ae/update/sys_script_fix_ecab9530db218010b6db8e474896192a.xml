<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_script_fix">
    <sys_script_fix action="INSERT_OR_UPDATE">
        <before>false</before>
        <description/>
        <name>Scoring algo</name>
        <record_for_rollback>false</record_for_rollback>
        <script><![CDATA[var answerArr1 = ['initialise()'];
var answerArr2 = ['Scheduled Jobs','Homepages'];

var testData = [{
        'questionID': '543041addb110010b6db8e47489619c1',
        'response': answerArr1,
        'responseTime': '5'
    },
    {
        'questionID': '7d630d21db510010b6db8e474896191d',
        'response': answerArr2,
        'responseTime': '13'
    }
];




var difficulty = 'easy';
var player = new GlideRecord("x_93700_arena_user");
player.setLimit(1);
player.addQuery("user", gs.getUserID());
player.query();
if (player.next()) {
   difficulty = player.difficulty.toString();
}



var level = 'level1'; //To be passed from widget
var levelPoints = 0;
var settings = '';



if (difficulty == 'easy')
    settings = gs.getProperty('x_93700_arena.easy_settings');
else if (difficulty == 'medium')
    settings = gs.getProperty('x_93700_arena.medium_settings');
else if (difficulty == 'difficult')
    settings = gs.getProperty('x_93700_arena.difficult_settings');




settings = JSON.parse(settings);
if(level == 'level1')
	levelPoints = settings.level_1_points;
else if(level == 'level2')
	levelPoints = settings.level_2_points;
else if(level == 'level3')
	levelPoints = settings.level_3_points;
else
	levelPoints = settings.level_4_points;

var totalPoints = 0;




var testDataLength = testData.length;
for (var i = 0; i < testDataLength; i++) {

	var rightAnswers = [];//We get right answers by gliderecording below
    var questionDB = new GlideRecord("x_93700_arena_arena_question");
    questionDB.setLimit(1);
    questionDB.addQuery("sys_id", testData[i].questionID);
    questionDB.query();
    if (questionDB.next()) {
	
        for (var iterator in questionDB.choices) {
          
				if(iterator.indexOf('_correct') != '-1') 
					{
						rightAnswers.push(questionDB.choices[iterator]);
					}
			
        }//Choices loop close

		
		var rightAnswerCount = rightAnswers.length;
		var rightResponseCount = 0;
		//comparing the correct answers with the answer array from the response
		if(testData[i].response.length == rightAnswerCount)//Only if user has enetered the right number of answers, we proceed
			{
			for(var k = 0; k<testData[i].response.length;k++)
				{
					for(var j = 0; j<rightAnswerCount;j++)
						{
							if(testData[i].response[k] == rightAnswers[j])
								{
									rightResponseCount++;
									break;
								}
						}
				}
				
				if(rightResponseCount == rightAnswerCount)
					totalPoints = parseInt(totalPoints) + parseInt(levelPoints * testData[i].responseTime);
				else
					totalPoints = parseInt(totalPoints) - parseInt(levelPoints * testData[i].responseTime);
			}
		else
			{
				totalPoints = parseInt(totalPoints) - parseInt(levelPoints * testData[i].responseTime);
			}
		
		
    }//GlideRecord close
}//Quiz answers for loop close

gs.info('totalPoints - ' + totalPoints);]]></script>
        <sys_class_name>sys_script_fix</sys_class_name>
        <sys_created_by>nikesh</sys_created_by>
        <sys_created_on>2019-12-03 15:08:49</sys_created_on>
        <sys_id>ecab9530db218010b6db8e474896192a</sys_id>
        <sys_mod_count>41</sys_mod_count>
        <sys_name>Scoring algo</sys_name>
        <sys_package display_value="Arena" source="x_93700_arena">661460dfdbc5c010b6db8e47489619ae</sys_package>
        <sys_policy/>
        <sys_scope display_value="Arena">661460dfdbc5c010b6db8e47489619ae</sys_scope>
        <sys_update_name>sys_script_fix_ecab9530db218010b6db8e474896192a</sys_update_name>
        <sys_updated_by>nikesh</sys_updated_by>
        <sys_updated_on>2020-01-31 02:02:30</sys_updated_on>
        <unloadable>false</unloadable>
    </sys_script_fix>
</record_update>
