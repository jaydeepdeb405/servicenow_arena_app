<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_script_include">
    <sys_script_include action="INSERT_OR_UPDATE">
        <access>public</access>
        <active>true</active>
        <api_name>x_93700_arena.ExportUtilAJAX</api_name>
        <caller_access/>
        <client_callable>true</client_callable>
        <description/>
        <name>ExportUtilAJAX</name>
        <script><![CDATA[var ExportUtilAJAX = Class.create();
ExportUtilAJAX.prototype = Object.extendsObject(global.AbstractAjaxProcessor, {
    check: function() {
        var trackerGr = new GlideRecord("sys_execution_tracker");
        trackerGr.addQuery("source_table", "incident");
        trackerGr.addQuery("state", "IN", "0,1");
        trackerGr.query();
        if (trackerGr.next())
            return trackerGr.getUniqueValue();
        return "";
    },

    /**
     * Start the Scripted Hierarchical Worker if one does not already exist
     */
    process: function() {
        var trackerId = this.check();
        if (trackerId)
            return trackerId;

		var table = this.getParameter("sysparm_ajax_processor_export_table");
		var filter = this.getParameter("sysparm_ajax_processor_export_filter");
		var fields = this.getParameter("sysparm_ajax_processor_export_fields");
		var title = this.getParameter("sysparm_ajax_processor_export_title");
		var totalRows = this.getParameter("sysparm_ajax_processor_export_rows");
        var worker = new GlideScriptedHierarchicalWorker();
        worker.setProgressName("Exporting "+totalRows+" rows...");
        worker.setScriptIncludeName("global.CreateIncidentWorker");
        worker.setScriptIncludeMethod("exportCSV");
		worker.putMethodArg("table", table);
		worker.putMethodArg("filter", filter);
		worker.putMethodArg("fields", fields);
		worker.putMethodArg("title", title);
		worker.putMethodArg("totalRows", totalRows);
        worker.setBackground(true);
        worker.start();

        return worker.getProgressID();
    },
    type: 'ExportUtilAJAX'
});]]></script>
        <sys_class_name>sys_script_include</sys_class_name>
        <sys_created_by>jaydeepdeb</sys_created_by>
        <sys_created_on>2020-09-24 14:20:22</sys_created_on>
        <sys_id>132765cc07abd01037c7f2ae7c1ed076</sys_id>
        <sys_mod_count>11</sys_mod_count>
        <sys_name>ExportUtilAJAX</sys_name>
        <sys_package display_value="Arena" source="x_93700_arena">661460dfdbc5c010b6db8e47489619ae</sys_package>
        <sys_policy>read</sys_policy>
        <sys_scope display_value="Arena">661460dfdbc5c010b6db8e47489619ae</sys_scope>
        <sys_update_name>sys_script_include_132765cc07abd01037c7f2ae7c1ed076</sys_update_name>
        <sys_updated_by>jaydeepdeb</sys_updated_by>
        <sys_updated_on>2020-09-24 16:53:06</sys_updated_on>
    </sys_script_include>
</record_update>
